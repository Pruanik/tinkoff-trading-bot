version: "3.3"

services:
  webapplication:
    env_file: .env
    container_name: webapplication
    build:
      context: .
      dockerfile: build/package/webapplication/Dockerfile
    ports:
      - "${WEB_APPLICATION_HOST_PORT:-80}:${WEB_APPLICATION_PORT:-80}"
    networks:
      - ttb_net
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0-oracle
    command: --default-authentication-plugin=mysql_native_password
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: 1
      MYSQL_DATABASE: "${DATABASE_NAME}"
      MYSQL_USER: "${DATABASE_USER}"
      MYSQL_PASSWORD: "${DATABASE_PASSWORD}"
    ports:
      - "${DATABASE_HOST_PORT:-3306}:3306"
    volumes:
      - ./data/mysql:/var/lib/mysql
    networks:
      - ttb_net

  # migrator:
  #   env_file: .env
  #   container_name: migrator
  #   build:
  #     context: .
  #     dockerfile: build/package/migrator/Dockerfile
  #   volumes:
  #     - ./migrations:/migrations
  #   networks:
  #     - ttb_net
networks:
  ttb_net:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"
